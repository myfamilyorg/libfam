/********************************************************************************
 * MIT License
 *
 * Copyright (c) 2025 Christopher Gilliard
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 *******************************************************************************/

#include <libfam/aighthash.h>
#include <libfam/bible.h>
#include <libfam/env.h>
#include <libfam/kem.h>
#include <libfam/limits.h>
#include <libfam/rng.h>
#include <libfam/storm.h>
#include <libfam/string.h>
#include <libfam/test_base.h>
#include <libfam/wots.h>

Test(storm_vectors) {
	StormContext ctx;
	__attribute__((aligned(32))) const u8 SEED[32] = {1, 2, 3};
	__attribute((aligned(32))) u8 buf1[32] = {
	    9,	 93,  216, 137, 224, 212, 105, 200, 163, 28,  146,
	    246, 75,  164, 149, 109, 209, 70,  183, 116, 224, 157,
	    245, 221, 5,   53,	245, 155, 165, 135, 142, 218};
	storm_init(&ctx, SEED);
	storm_next_block(&ctx, buf1);

	u8 exp1[32] = {0,   44, 64, 186, 106, 113, 172, 78,  14,  234, 67,
		       247, 7,	57, 25,	 97,  57,  105, 29,  115, 159, 138,
		       37,  57, 65, 176, 12,  144, 174, 186, 4,	  236};
	ASSERT(!memcmp(buf1, exp1, sizeof(buf1)), "buf1");
	storm_next_block(&ctx, buf1);

	u8 exp2[32] = {210, 174, 13,  100, 187, 212, 168, 128, 197, 235, 213,
		       78,  125, 115, 205, 92,	133, 242, 110, 234, 125, 133,
		       168, 230, 240, 252, 10,	168, 89,  227, 74,  62};

	ASSERT(!memcmp(buf1, exp2, sizeof(buf1)), "buf1 round2");

	__attribute((aligned(32))) u8 buf2[32] = {
	    32, 31, 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, 19, 18, 17,
	    16, 15, 14, 13, 12, 11, 10, 9,  8,	7,  6,	5,  4,	3,  2,	1};
	storm_init(&ctx, SEED);
	storm_next_block(&ctx, buf2);

	u8 exp3[32] = {76,  212, 26,  233, 216, 75,  41,  110, 6,   94,	 20,
		       169, 41,	 185, 138, 213, 219, 243, 79,  197, 109, 50,
		       141, 245, 8,   239, 144, 130, 167, 122, 21,  239};
	ASSERT(!memcmp(buf2, exp3, sizeof(buf2)), "buf2");

	storm_next_block(&ctx, buf2);

	u8 exp4[32] = {162, 251, 154, 18,  139, 107, 17,  243, 220, 138, 196,
		       181, 69,	 163, 85,  123, 226, 16,  149, 98,  13,	 154,
		       218, 24,	 241, 200, 137, 0,   247, 150, 246, 123};
	ASSERT(!memcmp(buf2, exp4, sizeof(buf2)), "buf2 round2");
}

Test(storm_cipher) {
	StormContext ctx;
	__attribute__((aligned(32))) const u8 SEED[32] = {1, 2, 3};
	__attribute__((aligned(32))) u8 buffer1[32] = {0};
	__attribute__((aligned(32))) u8 buffer2[32] = {0};
	__attribute__((aligned(32))) u8 buffer3[32] = {0};
	__attribute__((aligned(32))) u8 buffer4[32] = {0};
	__attribute__((aligned(32))) u8 buffer5[32] = {0};

	storm_init(&ctx, SEED);
	faststrcpy(buffer1, "test1");
	storm_xcrypt_buffer(&ctx, buffer1);
	faststrcpy(buffer2, "test2");
	storm_xcrypt_buffer(&ctx, buffer2);
	faststrcpy(buffer3, "blahblah");
	storm_xcrypt_buffer(&ctx, buffer3);
	faststrcpy(buffer4, "ok");
	storm_xcrypt_buffer(&ctx, buffer4);
	faststrcpy(buffer5, "x");
	storm_xcrypt_buffer(&ctx, buffer5);

	ASSERT(memcmp(buffer1, "test1", 5), "ne1");
	ASSERT(memcmp(buffer2, "test2", 5), "ne2");
	ASSERT(memcmp(buffer3, "blahblah", 8), "ne3");
	ASSERT(memcmp(buffer4, "ok", 2), "ne4");
	ASSERT(memcmp(buffer5, "x", 1), "ne5");

	StormContext ctx2;
	storm_init(&ctx2, SEED);

	storm_xcrypt_buffer(&ctx2, buffer1);
	ASSERT(!memcmp(buffer1, "test1", 5), "eq1");
	storm_xcrypt_buffer(&ctx2, buffer2);
	ASSERT(!memcmp(buffer2, "test2", 5), "eq2");

	storm_xcrypt_buffer(&ctx2, buffer3);
	ASSERT(!memcmp(buffer3, "blahblah", 8), "eq3");

	storm_xcrypt_buffer(&ctx2, buffer4);
	ASSERT(!memcmp(buffer4, "ok", 2), "eq4");

	storm_xcrypt_buffer(&ctx2, buffer5);
	ASSERT(!memcmp(buffer5, "x", 1), "eq5");
}

Test(storm_cipher_vector) {
	StormContext ctx;
	__attribute__((aligned(32))) const u8 SEED[32] = {1, 2, 3};
	__attribute__((aligned(32))) u8 buffer1[32] = {0};
	__attribute__((aligned(32))) u8 buffer2[32] = {0};

	storm_init(&ctx, SEED);
	faststrcpy(buffer1, "test1");
	storm_xcrypt_buffer(&ctx, buffer1);
	faststrcpy(buffer2, "test2");
	storm_xcrypt_buffer(&ctx, buffer2);

	u8 expected1[32] = {208, 219, 23,  2,	102, 98,  157, 53,
			    88,	 199, 188, 237, 126, 195, 16,  183,
			    63,	 14,  194, 187, 89,  153, 201, 245,
			    3,	 242, 121, 53,	200, 243, 205, 126};
	ASSERT(!memcmp(buffer1, expected1, 32), "expected1");
	u8 expected2[32] = {161, 153, 144, 19,	202, 43,  81,  154,
			    83,	 150, 76,  209, 103, 85,  1,   74,
			    116, 231, 230, 62,	23,  126, 208, 173,
			    13,	 252, 88,  139, 176, 20,  42,  167};
	ASSERT(!memcmp(buffer2, expected2, 32), "expected2");
}

#define STORM_COUNT (1000000000 / 32)
static __attribute__((aligned(32))) u8 ZERO_SEED[32] = {0};
static __attribute__((aligned(32))) u8 ONE_SEED[32] = {1};
static __attribute__((aligned(32))) u8 TWO_SEED[32] = {2};
static __attribute__((aligned(32))) u8 THREE_SEED[32] = {3};
static __attribute__((aligned(32))) u8 FOUR_SEED[32] = {4};
static __attribute__((aligned(32))) u8 FIVE_SEED[32] = {5};

Bench(storm) {
	i64 timer;
	__attribute__((aligned(32))) u8 buf1[64] = {0};
	__attribute__((aligned(32))) u8 buf2[64] = {0};
	__attribute__((aligned(32))) u8 buf3[64] = {0};
	__attribute__((aligned(32))) u8 buf4[64] = {0};
	__attribute__((aligned(32))) u8 buf5[64] = {0};
	__attribute__((aligned(32))) u8 buf6[64] = {0};

	StormContext ctx1;
	StormContext ctx2;
	StormContext ctx3;
	StormContext ctx4;
	StormContext ctx5;
	StormContext ctx6;

	storm_init(&ctx1, ZERO_SEED);
	storm_init(&ctx2, ONE_SEED);
	storm_init(&ctx3, TWO_SEED);
	storm_init(&ctx4, THREE_SEED);
	storm_init(&ctx5, FOUR_SEED);
	storm_init(&ctx6, FIVE_SEED);

	timer = micros();
	for (u32 i = 0; i < STORM_COUNT; i++) {
		u8* block1 = buf1 + (i & 32);
		u8* block2 = buf2 + (i & 32);
		u8* block3 = buf3 + (i & 32);
		u8* block4 = buf4 + (i & 32);
		u8* block5 = buf5 + (i & 32);
		u8* block6 = buf6 + (i & 32);

		storm_xcrypt_buffer(&ctx1, block1);
		storm_xcrypt_buffer(&ctx2, block2);
		storm_xcrypt_buffer(&ctx3, block3);
		storm_xcrypt_buffer(&ctx4, block4);
		storm_xcrypt_buffer(&ctx5, block5);
		storm_xcrypt_buffer(&ctx6, block6);
	}
	timer = micros() - timer;

	pwrite(2, "time=", 5, 0);
	write_num(2, timer);
	pwrite(2, ",avg=", 5, 0);
	write_num(2, (timer * 1000) / STORM_COUNT);
	pwrite(2, "ns\n", 3, 0);
}

Test(rng) {
	u64 x = 0, y = 0;
	__attribute__((aligned(32))) u8 z[64] = {0};
	Rng rng;
	__attribute__((aligned(32))) u8 key[32] = {5, 5, 5, 5};
	rng_init(&rng);
	rng_gen(&rng, &x, sizeof(x));
	rng_init(&rng);
	rng_gen(&rng, &y, sizeof(y));
	ASSERT(x != y, "x!=y");

	rng_test_seed(&rng, key);
	rng_gen(&rng, z, sizeof(z));

	u8 expected[64] = {
	    241, 172, 79,  71,	20,  35,  84,  2,   39,	 165, 18,  232, 21,
	    84,	 178, 57,  205, 39,  187, 146, 20,  199, 114, 41,  245, 137,
	    175, 6,   181, 187, 130, 62,  195, 118, 94,	 242, 150, 45,	156,
	    18,	 240, 207, 220, 197, 36,  154, 149, 82,	 140, 108, 33,	154,
	    30,	 22,  146, 169, 199, 72,  2,   124, 117, 60,  141, 191};
	ASSERT_EQ(memcmp(z, expected, 64), 0, "z");
}

#define RNG_BYTES (32 * 1000000ULL)

Bench(rngpf) {
	u8 fbuf[1024] = {0};
	__attribute__((aligned(32))) u8 buffer1[32] = {0};
	__attribute__((aligned(32))) u8 buffer2[32] = {0};
	__attribute__((aligned(32))) u8 buffer3[32] = {0};
	__attribute__((aligned(32))) u8 buffer4[32] = {0};
	__attribute__((aligned(32))) u8 buffer5[32] = {0};
	__attribute__((aligned(32))) u8 buffer6[32] = {0};

	i64 needed = RNG_BYTES;
	Rng rng1, rng2, rng3, rng4, rng5, rng6;
	u64 total_cycles = 0;

	rng_init(&rng1);
	rng_init(&rng2);
	rng_init(&rng3);
	rng_init(&rng4);
	rng_init(&rng5);
	rng_init(&rng6);

	while (needed > 0) {
		u64 start;
		start = cycle_counter();
		rng_gen(&rng1, buffer1, 32);
		rng_gen(&rng2, buffer2, 32);
		rng_gen(&rng3, buffer3, 32);
		rng_gen(&rng4, buffer4, 32);
		rng_gen(&rng5, buffer5, 32);
		rng_gen(&rng6, buffer6, 32);
		total_cycles += cycle_counter() - start;

		needed -= 32;
	}
	const u8 msg[] = "cycles_per_byte=";
	pwrite(2, msg, strlen(msg), 0);
	f64_to_string(fbuf,
		      (f64)(total_cycles * 100 / (6 * RNG_BYTES)) / (f64)100, 2,
		      false);
	pwrite(2, fbuf, strlen(fbuf), 0);
	pwrite(2, "\n", 1, 0);
}

Test(aighthash) {
	u32 v1, v2, v3;

	v1 = aighthash32("11111111abc", 11, 0);
	v2 = aighthash32("11111111abc\0", 12, 0);
	v3 = aighthash32("11111111abc", 11, 0);
	ASSERT(v1 != v2, "v1 != v2");
	ASSERT(v1 == v3, "v1 == v3");

	u64 h1, h2, h3;

	h1 = aighthash64("XXXXXXXXXXXXXXXXxyz", 19, 0);
	h2 = aighthash64("XXXXXXXXXXXXXXXXxyz\0", 20, 0);
	h3 = aighthash64("XXXXXXXXXXXXXXXXxyz", 19, 0);
	ASSERT(h1 != h2, "h1 != h2");
	ASSERT(h1 == h3, "h1 == h3");
}

Test(wots) {
	__attribute__((aligned(32))) u8 key[32] = {1, 2, 3, 4, 5};
	WotsPubKey pk;
	WotsSecKey sk;
	WotsSig sig;
	u8 msg[32] = {9, 9, 9, 9, 9, 4};

	wots_keyfrom(key, &pk, &sk);
	wots_sign(&sk, msg, &sig);
	ASSERT(!wots_verify(&pk, &sig, msg), "verify");
	msg[0]++;
	ASSERT(wots_verify(&pk, &sig, msg), "!verify");
}

#define WOTS_COUNT 1000

Bench(wotsp) {
	__attribute__((aligned(32))) u8 key[32] = {0};
	__attribute__((aligned(32))) u8 msg[32] = {0};
	WotsPubKey pk;
	WotsSecKey sk;
	WotsSig sig;

	Rng rng;
	u64 keygen_sum = 0;
	u64 sign_sum = 0;
	u64 verify_sum = 0;

	rng_init(&rng);

	for (u32 i = 0; i < WOTS_COUNT; i++) {
		rng_gen(&rng, key, 32);
		rng_gen(&rng, msg, 32);

		u64 start = cycle_counter();
		wots_keyfrom(key, &pk, &sk);
		keygen_sum += cycle_counter() - start;
		start = cycle_counter();
		wots_sign(&sk, msg, &sig);
		sign_sum += cycle_counter() - start;
		start = cycle_counter();
		i32 res = wots_verify(&pk, &sig, msg);
		verify_sum += cycle_counter() - start;
		ASSERT(!res, "verify");
		msg[0]++;
		ASSERT(wots_verify(&pk, &sig, msg), "!verify");
	}

	pwrite(2, "keygen=", 7, 0);
	write_num(2, keygen_sum / WOTS_COUNT);
	pwrite(2, ",sign=", 6, 0);
	write_num(2, sign_sum / WOTS_COUNT);
	pwrite(2, ",verify=", 8, 0);
	write_num(2, verify_sum / WOTS_COUNT);
	pwrite(2, "\n", 1, 0);
}

#define BIBLE_PATH "resources/test_bible.dat"

Test(bible) {
	const Bible* b;
	u64 sbox[256];
	__attribute__((aligned(32))) static const u8 input[128] = {
	    1,	2,  3,	4,  5,	6,  7,	8,  9,	10, 11, 12, 13, 14, 15, 16,
	    17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32};
	__attribute__((aligned(32))) u8 output[32];

	if (!exists(BIBLE_PATH)) {
		if (IS_VALGRIND()) return;
		b = bible_gen(false);
		bible_store(b, BIBLE_PATH);
	} else
		b = bible_load(BIBLE_PATH);

	bible_sbox8_64(sbox);
	bible_hash(b, input, output, sbox);

	u8 expected[32] = {161, 219, 95,  165, 143, 81,	 8,  96,  175, 215, 101,
			   246, 130, 254, 99,  17,  61,	 84, 7,	  110, 157, 128,
			   179, 165, 67,  64,  193, 247, 70, 100, 54,  146};

	ASSERT(!memcmp(output, expected, 32), "hash");
	bible_destroy(b);
	b = bible_load(BIBLE_PATH);
	bible_destroy(b);
}

Test(bible_mine) {
	const Bible* b;
	u32 nonce = 0;
	u64 sbox[256];
	__attribute__((aligned(32))) u8 output[32] = {0};
	u8 target[32];
	__attribute((aligned(32))) u8 header[HASH_INPUT_LEN];

	for (u32 i = 0; i < HASH_INPUT_LEN; i++) header[i] = i;

	if (!exists(BIBLE_PATH)) {
		if (IS_VALGRIND()) return;
		b = bible_gen(false);
		bible_store(b, BIBLE_PATH);
	} else
		b = bible_load(BIBLE_PATH);

	memset(target, 0xFF, 32);
	target[0] = 0;
	target[1] = 0;
	bible_sbox8_64(sbox);
	mine_block(b, header, target, output, &nonce, U32_MAX, sbox);

	ASSERT_EQ(nonce, 1312, "nonce");
	ASSERT(!memcmp(output, (u8[]){0,   0,	28,  44,  170, 182, 139, 188,
				      55,  146, 148, 53,  14,  68,  79,	 182,
				      130, 246, 76,  17,  102, 240, 129, 186,
				      69,  227, 176, 231, 224, 33,  141, 0},
		       32),
	       "hash");
	bible_destroy(b);
}

Test(kem) {
	KemSecKey sk;
	KemPubKey pk;
	KemCipherText ct;
	KemSharedSecret ss_bob = {0}, ss_alice = {0};

	Rng rng1, rng2;
	rng_init(&rng1);
	rng_init(&rng2);
	keypair(&pk, &sk, &rng1);
	enc(&ct, &ss_bob, &pk, &rng2);
	dec(&ss_alice, &ct, &sk);
	ASSERT(!fastmemcmp(&ss_bob, &ss_alice, KEM_SS_SIZE), "shared secret");
}

#include <libfam/format.h>

Test(kem_vector) {
	__attribute__((aligned(32))) u8 seed[32] = {1, 2, 3};
	KemSecKey sk;
	KemPubKey pk;
	KemCipherText ct;
	KemSharedSecret ss_bob = {0}, ss_alice = {0};

	Rng rng;
	rng_init(&rng);
	rng_test_seed(&rng, seed);
	keypair(&pk, &sk, &rng);
	// print("sk: ");
	// for (u32 i = 0; i < sizeof(sk); i++) print("{}, ", sk.data[i]);
	u8 expected_sk[] = {
	    202, 229, 135, 92,	120, 95,  253, 244, 120, 162, 199, 89,	92,
	    83,	 144, 199, 84,	18,  120, 133, 66,  88,	 68,  172, 152, 172,
	    196, 82,  66,  207, 252, 128, 32,  39,  23,	 65,  152, 124, 157,
	    116, 20,  123, 113, 122, 120, 88,  17,  31,	 221, 57,  148, 35,
	    160, 91,  197, 160, 126, 63,  218, 111, 69,	 210, 31,  11,	26,
	    63,	 241, 115, 83,	62,  231, 186, 165, 100, 188, 95,  204, 59,
	    225, 92,  48,  180, 136, 44,  118, 96,  23,	 208, 108, 53,	36,
	    249, 151, 191, 136, 20,  67,  64,  77,  78,	 0,   106, 9,	129,
	    202, 62,  199, 171, 86,  226, 193, 53,  154, 44,  167, 44,	111,
	    81,	 156, 137, 12,	24,  40,  169, 119, 100, 219, 204, 192, 33,
	    70,	 156, 210, 33,	129, 207, 161, 78,  111, 36,  147, 9,	176,
	    25,	 36,  137, 152, 80,  99,  207, 70,  116, 165, 69,  86,	175,
	    8,	 69,  196, 238, 25,  62,  99,  68,  181, 63,  133, 196, 155,
	    119, 186, 158, 42,	169, 58,  99,  190, 183, 203, 182, 99,	90,
	    179, 161, 35,  58,	75,  90,  20,  12,  11,	 96,  61,  240, 111,
	    92,	 98,  204, 40,	11,  198, 41,  4,   0,	 238, 100, 95,	129,
	    133, 91,  51,  138, 36,  204, 67,  204, 75,	 104, 52,  106, 145,
	    83,	 78,  218, 152, 96,  212, 58,  173, 234, 13,  239, 91,	66,
	    168, 177, 24,  126, 160, 170, 254, 88,  152, 20,  64,  160, 60,
	    171, 182, 166, 27,	205, 135, 132, 44,  107, 4,   174, 235, 136,
	    197, 45,  76,  172, 132, 57,  121, 26,  114, 10,  16,  138, 80,
	    58,	 186, 4,   19,	194, 44,  239, 103, 111, 65,  51,  54,	210,
	    121, 49,  22,  27,	118, 243, 133, 18,  140, 181, 99,  100, 81,
	    139, 131, 42,  8,	204, 236, 46,  10,  240, 111, 153, 186, 172,
	    73,	 166, 205, 125, 186, 166, 12,  12,  136, 163, 154, 162, 157,
	    116, 98,  54,  85,	58,  70,  211, 144, 175, 108, 97,  8,	17,
	    123, 247, 7,   87,	228, 200, 24,  120, 147, 167, 120, 70,	117,
	    201, 192, 143, 20,	38,  93,  192, 122, 36,	 11,  40,  117, 103,
	    101, 97,  199, 213, 57,  68,  229, 4,   136, 24,  182, 250, 6,
	    109, 220, 73,  21,	54,  146, 114, 185, 240, 47,  86,  214, 83,
	    3,	 169, 30,  209, 11,  101, 30,  44,  165, 106, 135, 189, 52,
	    80,	 157, 129, 82,	199, 154, 235, 38,  198, 8,   133, 56,	98,
	    25,	 43,  27,  166, 186, 153, 65,  124, 198, 32,  91,  198, 48,
	    22,	 87,  12,  250, 212, 186, 173, 212, 51,	 12,  245, 177, 247,
	    41,	 74,  48,  0,	180, 123, 87,  172, 162, 180, 34,  92,	26,
	    68,	 212, 227, 72,	20,  184, 9,   85,  166, 74,  232, 134, 112,
	    144, 252, 125, 55,	1,   184, 5,   101, 137, 106, 248, 166, 213,
	    247, 43,  191, 118, 38,  234, 218, 135, 118, 188, 113, 214, 72,
	    44,	 122, 117, 192, 23,  132, 113, 83,  71,	 197, 158, 9,	113,
	    0,	 101, 61,  132, 32,  105, 204, 11,  47,	 6,   58,  120, 132,
	    75,	 114, 207, 212, 40,  255, 16,  147, 243, 172, 115, 97,	1,
	    130, 101, 216, 90,	194, 70,  118, 133, 182, 30,  14,  227, 17,
	    50,	 216, 88,  146, 115, 3,	  126, 209, 52,	 226, 140, 111, 227,
	    70,	 82,  26,  50,	67,  73,  187, 196, 152, 51,  126, 12,	180,
	    200, 89,  4,   58,	167, 69,  98,  45,  202, 207, 244, 140, 71,
	    176, 76,  2,   43,	145, 77,  105, 228, 199, 37,  164, 111, 99,
	    88,	 17,  95,  55,	166, 182, 55,  129, 133, 49,  12,  58,	83,
	    41,	 115, 44,  136, 146, 194, 176, 103, 122, 17,  10,  187, 5,
	    60,	 1,   54,  232, 70,  27,  156, 200, 193, 228, 195, 47,	215,
	    250, 117, 114, 44,	207, 76,  56,  132, 213, 0,   71,  30,	240,
	    75,	 128, 197, 116, 106, 67,  120, 239, 10,	 194, 4,   182, 81,
	    120, 91,  169, 122, 108, 161, 96,  183, 85,	 228, 92,  178, 59,
	    181, 46,  113, 150, 22,  191, 6,   108, 194, 204, 43,  247, 27,
	    74,	 112, 116, 29,	48,  116, 126, 95,  80,	 59,  212, 164, 24,
	    126, 59,  19,  195, 104, 92,  27,  169, 149, 27,  122, 8,	194,
	    242, 21,  52,  184, 113, 161, 216, 55,  34,	 250, 84,  219, 85,
	    104, 128, 8,   5,	16,  154, 44,  67,  25,	 138, 220, 164, 130,
	    139, 130, 90,  37,	10,  190, 70,  231, 86,	 143, 216, 78,	145,
	    51,	 10,  152, 65,	134, 82,  233, 168, 134, 73,  88,  80,	91,
	    173, 120, 4,   147, 238, 170, 192, 146, 123, 140, 71,  219, 107,
	    53,	 186, 100, 193, 91,  188, 227, 86,  28,	 153, 41,  115, 15,
	    170, 58,  123, 115, 126, 57,  25,  175, 187, 211, 26,  35,	92,
	    101, 84,  167, 188, 78,  224, 0,   115, 232, 166, 213, 186, 189,
	    164, 163, 176, 25,	74,  13,  182, 151, 60,	 99,  108, 141, 132,
	    68,	 72,  80,  169, 113, 247, 28,  207, 255, 139, 31,  241, 90,
	    119, 60,  115, 178, 92,  200, 41,  54,  9,	 22,  211, 76,	132,
	    133, 183, 45,  52,	146, 182, 121, 38,  118, 105, 133, 157, 54,
	    192, 94,  0,   102, 153, 124, 140, 140, 106, 70,  134, 243, 178,
	    5,	 190, 35,  136, 244, 118, 129, 63,  192, 196, 252, 42,	202,
	    253, 209, 27,  49,	248, 195, 82,  35,  125, 8,   41,  69,	191,
	    80,	 7,   184, 148, 78,  68,  27,  56,  187, 233, 57,  88,	162,
	    5,	 145, 129, 32,	82,  144, 156, 190, 12,	 189, 32,  156, 178,
	    199, 6,   9,   76,	64,  125, 246, 236, 58,	 244, 178, 139, 184,
	    83,	 86,  10,  18,	41,  169, 178, 175, 175, 113, 148, 172, 163,
	    57,	 38,  170, 186, 41,  148, 40,  68,  172, 101, 13,  242, 41,
	    195, 102, 15,  156, 186, 4,	  13,  117, 2,	 86,  86,  50,	49,
	    99,	 53,  185, 8,	88,  8,	  145, 155, 75,	 144, 116, 62,	9,
	    32,	 109, 87,  32,	129, 35,  191, 136, 17,	 102, 67,  114, 157,
	    105, 154, 20,  137, 101, 38,  212, 192, 91,	 153, 165, 120, 83,
	    195, 36,  61,  132, 114, 63,  212, 37,  56,	 170, 57,  250, 168,
	    128, 224, 244, 104, 64,  87,  119, 1,   186, 167, 249, 71,	171,
	    166, 57,  53,  142, 54,  64,  4,   12,  59,	 237, 107, 119, 77,
	    184, 156, 132, 64,	31,  253, 201, 115, 166, 150, 102, 62,	163,
	    122, 81,  10,  63,	147, 204, 155, 234, 68,	 54,  68,  186, 26,
	    6,	 211, 12,  67,	104, 24,  83,  112, 132, 145, 155, 164, 116,
	    163, 111, 226, 38,	101, 231, 67,  18,  47,	 121, 105, 64,	228,
	    125, 225, 155, 59,	15,  226, 43,  221, 44,	 177, 52,  214, 35,
	    126, 6,   26,  183, 83,  188, 218, 195, 186, 36,  204, 157, 237,
	    7,	 95,  165, 135, 113, 117, 136, 159, 90,	 165, 47,  69,	233,
	    11,	 43,  151, 86,	8,   231, 167, 188, 164, 9,   149, 60,	69,
	    28,	 3,   71,  238, 162, 180, 182, 147, 155, 16,  39,  102, 60,
	    36,	 115, 20,  70,	161, 233, 179, 204, 19,	 228, 111, 224, 89,
	    107, 167, 123, 178, 119, 250, 130, 203, 184, 142, 132, 57,	138,
	    172, 105, 112, 155, 0,   79,  214, 231, 52,	 168, 0,   26,	254,
	    130, 106, 180, 193, 128, 234, 102, 136, 102, 193, 185, 72,	167,
	    197, 31,  236, 5,	254, 161, 22,  89,  104, 136, 138, 17,	28,
	    42,	 72,  58,  92,	92,  71,  44,  87,  43,	 151, 151, 95,	158,
	    59,	 109, 217, 72,	121, 157, 136, 169, 100, 65,  141, 35,	228,
	    80,	 7,   54,  194, 13,  150, 182, 221, 6,	 89,  217, 4,	79,
	    105, 50,  38,  54,	215, 69,  100, 137, 43,	 133, 113, 33,	58,
	    44,	 20,  249, 154, 112, 43,  2,   80,  238, 4,   49,  218, 85,
	    8,	 1,   242, 202, 219, 180, 88,  21,  35,	 93,  222, 104, 204,
	    184, 7,   101, 235, 201, 97,  34,  83,  176, 95,  115, 197, 228,
	    248, 46,  195, 168, 171, 135, 153, 71,  109, 131, 2,   192, 76,
	    69,	 199, 23,  207, 225, 168, 39,  162, 247, 53,  102, 52,	172,
	    13,	 231, 158, 144, 38,  72,  3,   3,   107, 38,  39,  59,	100,
	    184, 133, 182, 134, 73,  185, 64,  176, 111, 145, 48,  221, 251,
	    142, 72,  134, 32,	228, 149, 197, 19,  169, 118, 240, 66,	148,
	    115, 242, 177, 187, 48,  9,	  67,  2,   10,	 79,  244, 43,	134,
	    100, 67,  159, 23,	151, 163, 92,  163, 43,	 76,  126, 200, 17,
	    47,	 192, 117, 46,	95,  233, 194, 234, 68,	 61,  162, 43,	171,
	    181, 184, 111, 123, 124, 113, 135, 201, 126, 21,  38,  194, 121,
	    36,	 195, 219, 102, 123, 90,  149, 84,  81,	 53,  8,   149, 131,
	    62,	 252, 70,  101, 198, 235, 59,  149, 2,	 11,  27,  107, 133,
	    119, 24,  10,  125, 185, 142, 112, 145, 73,	 126, 71,  92,	226,
	    163, 188, 213, 2,	13,  103, 130, 42,  108, 216, 196, 89,	57,
	    66,	 46,  88,  22,	22,  69,  190, 99,  74,	 78,  12,  25,	28,
	    131, 83,  16,  102, 82,  3,	  94,  8,   154, 198, 84,  34,	232,
	    232, 135, 250, 30,	19,  136, 6,   35,  19,	 153, 114, 61,	42,
	    183, 70,  185, 223, 50,  0,	  13,  111, 183, 61,  118, 47,	189,
	    227, 89,  26,  152, 245, 247, 226, 81,  85,	 6,   199, 1,	227,
	    233, 103, 186, 32,	208, 231, 199, 24,  42,	 19,  65,  33,	70,
	    23,	 225, 220, 21,	217, 136, 79,  217, 89,	 156, 129, 66,	24,
	    77,	 175, 242, 27,	187, 98,  87,  212, 220, 169, 50,  128, 55,
	    38,	 100, 170, 60,	13,  170, 233, 101, 210, 192, 153, 214, 142,
	    115, 99,  39,  49,	106, 123, 15};

	u8 expected_pk[] = {
	    120, 4,   147, 238, 170, 192, 146, 123, 140, 71,  219, 107, 53,
	    186, 100, 193, 91,	188, 227, 86,  28,  153, 41,  115, 15,	170,
	    58,	 123, 115, 126, 57,  25,  175, 187, 211, 26,  35,  92,	101,
	    84,	 167, 188, 78,	224, 0,	  115, 232, 166, 213, 186, 189, 164,
	    163, 176, 25,  74,	13,  182, 151, 60,  99,	 108, 141, 132, 68,
	    72,	 80,  169, 113, 247, 28,  207, 255, 139, 31,  241, 90,	119,
	    60,	 115, 178, 92,	200, 41,  54,  9,   22,	 211, 76,  132, 133,
	    183, 45,  52,  146, 182, 121, 38,  118, 105, 133, 157, 54,	192,
	    94,	 0,   102, 153, 124, 140, 140, 106, 70,	 134, 243, 178, 5,
	    190, 35,  136, 244, 118, 129, 63,  192, 196, 252, 42,  202, 253,
	    209, 27,  49,  248, 195, 82,  35,  125, 8,	 41,  69,  191, 80,
	    7,	 184, 148, 78,	68,  27,  56,  187, 233, 57,  88,  162, 5,
	    145, 129, 32,  82,	144, 156, 190, 12,  189, 32,  156, 178, 199,
	    6,	 9,   76,  64,	125, 246, 236, 58,  244, 178, 139, 184, 83,
	    86,	 10,  18,  41,	169, 178, 175, 175, 113, 148, 172, 163, 57,
	    38,	 170, 186, 41,	148, 40,  68,  172, 101, 13,  242, 41,	195,
	    102, 15,  156, 186, 4,   13,  117, 2,   86,	 86,  50,  49,	99,
	    53,	 185, 8,   88,	8,   145, 155, 75,  144, 116, 62,  9,	32,
	    109, 87,  32,  129, 35,  191, 136, 17,  102, 67,  114, 157, 105,
	    154, 20,  137, 101, 38,  212, 192, 91,  153, 165, 120, 83,	195,
	    36,	 61,  132, 114, 63,  212, 37,  56,  170, 57,  250, 168, 128,
	    224, 244, 104, 64,	87,  119, 1,   186, 167, 249, 71,  171, 166,
	    57,	 53,  142, 54,	64,  4,	  12,  59,  237, 107, 119, 77,	184,
	    156, 132, 64,  31,	253, 201, 115, 166, 150, 102, 62,  163, 122,
	    81,	 10,  63,  147, 204, 155, 234, 68,  54,	 68,  186, 26,	6,
	    211, 12,  67,  104, 24,  83,  112, 132, 145, 155, 164, 116, 163,
	    111, 226, 38,  101, 231, 67,  18,  47,  121, 105, 64,  228, 125,
	    225, 155, 59,  15,	226, 43,  221, 44,  177, 52,  214, 35,	126,
	    6,	 26,  183, 83,	188, 218, 195, 186, 36,	 204, 157, 237, 7,
	    95,	 165, 135, 113, 117, 136, 159, 90,  165, 47,  69,  233, 11,
	    43,	 151, 86,  8,	231, 167, 188, 164, 9,	 149, 60,  69,	28,
	    3,	 71,  238, 162, 180, 182, 147, 155, 16,	 39,  102, 60,	36,
	    115, 20,  70,  161, 233, 179, 204, 19,  228, 111, 224, 89,	107,
	    167, 123, 178, 119, 250, 130, 203, 184, 142, 132, 57,  138, 172,
	    105, 112, 155, 0,	79,  214, 231, 52,  168, 0,   26,  254, 130,
	    106, 180, 193, 128, 234, 102, 136, 102, 193, 185, 72,  167, 197,
	    31,	 236, 5,   254, 161, 22,  89,  104, 136, 138, 17,  28,	42,
	    72,	 58,  92,  92,	71,  44,  87,  43,  151, 151, 95,  158, 59,
	    109, 217, 72,  121, 157, 136, 169, 100, 65,	 141, 35,  228, 80,
	    7,	 54,  194, 13,	150, 182, 221, 6,   89,	 217, 4,   79,	105,
	    50,	 38,  54,  215, 69,  100, 137, 43,  133, 113, 33,  58,	44,
	    20,	 249, 154, 112, 43,  2,	  80,  238, 4,	 49,  218, 85,	8,
	    1,	 242, 202, 219, 180, 88,  21,  35,  93,	 222, 104, 204, 184,
	    7,	 101, 235, 201, 97,  34,  83,  176, 95,	 115, 197, 228, 248,
	    46,	 195, 168, 171, 135, 153, 71,  109, 131, 2,   192, 76,	69,
	    199, 23,  207, 225, 168, 39,  162, 247, 53,	 102, 52,  172, 13,
	    231, 158, 144, 38,	72,  3,	  3,   107, 38,	 39,  59,  100, 184,
	    133, 182, 134, 73,	185, 64,  176, 111, 145, 48,  221, 251, 142,
	    72,	 134, 32,  228, 149, 197, 19,  169, 118, 240, 66,  148, 115,
	    242, 177, 187, 48,	9,   67,  2,   10,  79,	 244, 43,  134, 100,
	    67,	 159, 23,  151, 163, 92,  163, 43,  76,	 126, 200, 17,	47,
	    192, 117, 46,  95,	233, 194, 234, 68,  61,	 162, 43,  171, 181,
	    184, 111, 123, 124, 113, 135, 201, 126, 21,	 38,  194, 121, 36,
	    195, 219, 102, 123, 90,  149, 84,  81,  53,	 8,   149, 131, 62,
	    252, 70,  101, 198, 235, 59,  149, 2,   11,	 27,  107, 133, 119,
	    24,	 10,  125, 185, 142, 112, 145, 73,  126, 71,  92,  226, 163,
	    188, 213, 2,   13,	103, 130, 42,  108, 216, 196, 89,  57,	66,
	    46,	 88,  22,  22,	69,  190, 99,  74,  78,	 12,  25,  28,	131,
	    83,	 16,  102, 82,	3,   94,  8,   154, 198, 84,  34,  232, 232,
	    135, 250, 30,  19,	136, 6,	  35,  19,  153, 114, 61,  42,	183,
	    70,	 185, 223, 50,	0,   13,  111, 183, 61,	 118, 47,  189, 227,
	    89,	 26,  152, 245, 247, 226, 81};
	ASSERT(!fastmemcmp(pk.data, expected_pk, sizeof(pk)), "pk");
	ASSERT(!fastmemcmp(sk.data, expected_sk, sizeof(sk)), "sk");
	enc(&ct, &ss_bob, &pk, &rng);
	u8 expected_ct[] = {
	    250, 29,  73,  173, 157, 227, 145, 17,  107, 179, 113, 61,	207,
	    204, 116, 32,  149, 121, 88,  166, 209, 4,	 74,  208, 114, 42,
	    8,	 15,  132, 71,	108, 190, 4,   137, 4,	 149, 234, 88,	180,
	    53,	 128, 113, 174, 164, 1,	  38,  194, 241, 26,  183, 112, 99,
	    192, 57,  142, 214, 109, 72,  80,  103, 209, 157, 181, 26,	15,
	    78,	 87,  53,  201, 121, 50,  214, 62,  217, 247, 15,  71,	87,
	    194, 196, 55,  87,	96,  127, 77,  103, 20,	 92,  10,  87,	215,
	    97,	 132, 209, 174, 175, 20,  192, 185, 78,	 198, 151, 201, 218,
	    0,	 151, 175, 73,	133, 116, 226, 154, 42,	 148, 225, 206, 110,
	    43,	 36,  168, 119, 81,  105, 208, 130, 75,	 223, 121, 230, 119,
	    213, 41,  2,   92,	47,  236, 72,  26,  136, 67,  211, 74,	202,
	    176, 77,  73,  195, 75,  26,  151, 114, 132, 8,   4,   205, 144,
	    198, 217, 155, 38,	115, 82,  3,   162, 148, 91,  162, 61,	252,
	    140, 202, 192, 45,	124, 59,  137, 98,  121, 12,  104, 177, 172,
	    76,	 168, 212, 151, 38,  16,  141, 232, 76,	 107, 223, 13,	251,
	    50,	 36,  36,  169, 225, 51,  228, 115, 80,	 243, 108, 202, 184,
	    108, 254, 230, 83,	138, 19,  154, 107, 122, 126, 225, 7,	249,
	    166, 234, 130, 221, 42,  117, 56,  219, 79,	 13,  108, 86,	59,
	    5,	 39,  137, 86,	121, 100, 74,  215, 96,	 57,  4,   193, 17,
	    40,	 44,  250, 123, 176, 212, 52,  241, 185, 65,  217, 101, 191,
	    37,	 102, 161, 224, 90,  160, 145, 132, 139, 167, 9,   159, 117,
	    246, 223, 187, 166, 84,  151, 126, 237, 89,	 10,  62,  67,	133,
	    78,	 43,  53,  34,	248, 240, 22,  214, 42,	 101, 25,  49,	41,
	    121, 206, 43,  132, 190, 10,  57,  17,  136, 34,  229, 136, 162,
	    25,	 194, 127, 113, 171, 244, 179, 30,  33,	 196, 122, 199, 144,
	    100, 56,  146, 224, 61,  156, 247, 126, 35,	 9,   165, 139, 54,
	    232, 194, 94,  92,	163, 8,	  156, 154, 67,	 132, 47,  153, 198,
	    117, 235, 176, 17,	148, 152, 11,  54,  175, 251, 19,  211, 138,
	    35,	 123, 58,  146, 179, 174, 154, 54,  199, 142, 232, 148, 56,
	    13,	 33,  76,  157, 102, 228, 11,  65,  128, 224, 191, 193, 185,
	    136, 150, 220, 249, 208, 110, 111, 184, 203, 112, 202, 252, 83,
	    49,	 108, 182, 63,	18,  148, 34,  69,  53,	 58,  188, 206, 191,
	    29,	 28,  121, 35,	22,  128, 166, 56,  215, 118, 153, 116, 212,
	    255, 38,  128, 183, 88,  187, 149, 106, 23,	 152, 122, 162, 145,
	    242, 180, 180, 56,	56,  34,  75,  130, 18,	 104, 32,  233, 181,
	    232, 3,   19,  47,	11,  39,  118, 83,  141, 224, 6,   61,	34,
	    181, 190, 74,  132, 103, 190, 80,  234, 12,	 211, 109, 187, 183,
	    251, 125, 102, 111, 201, 70,  109, 3,   6,	 203, 62,  96,	110,
	    122, 193, 248, 109, 72,  46,  88,  167, 45,	 70,  25,  128, 253,
	    136, 154, 160, 81,	13,  20,  33,  66,  230, 27,  166, 56,	210,
	    27,	 152, 22,  169, 129, 125, 90,  11,  67,	 14,  70,  222, 43,
	    215, 117, 110, 39,	213, 215, 143, 45,  205, 167, 116, 107, 161,
	    17,	 144, 12,  141, 146, 13,  41,  96,  77,	 146, 40,  194, 153,
	    188, 85,  105, 198, 161, 74,  110, 55,  183, 71,  233, 255, 110,
	    71,	 86,  234, 84,	18,  189, 165, 45,  172, 10,  107, 183, 185,
	    144, 123, 215, 144, 33,  14,  127, 22,  209, 49,  98,  233, 33,
	    85,	 225, 247, 5,	47,  250, 248, 215, 74,	 151, 131, 101, 253,
	    45,	 232, 20,  43,	65,  16,  127, 154, 142, 74,  142, 231, 134,
	    49,	 219, 192, 0,	187, 57,  32,  72,  239, 118, 210, 64,	105,
	    254, 43,  32,  5,	26,  81,  179, 243, 114, 229, 105, 252, 181,
	    20,	 114, 204, 34,	184, 186, 11,  137, 1,	 3,   92,  201, 152,
	    197, 103, 99,  94,	37,  45,  241, 50,  255, 43,  152, 240, 27,
	    185, 78,  32,  137, 99,  156, 130, 148, 16,	 77,  27,  189, 30,
	    101, 81,  54,  174, 68,  54,  12,  240, 208, 7,   97,  196, 190,
	    73,	 27,  224, 73,	30,  225, 35,  100, 132, 190, 249, 46,	182,
	    71,	 153, 51,  170, 151, 117, 97,  232, 93,	 88,  106, 194, 113,
	    123, 182, 78,  30,	18,  124, 228, 132, 107, 202, 225, 30,	175,
	    113, 138, 158, 42,	213, 138, 96,  182, 60,	 239, 98,  80,	37,
	    187, 62,  3,   187, 102, 211, 189, 117, 235, 75,  80,  231, 149,
	    82};
	// print("ct: ");
	// for (u32 i = 0; i < sizeof(ct); i++) print("{}, ", ct.data[i]);
	(void)expected_ct;
	(void)expected_pk;
	(void)expected_sk;
	ASSERT(!memcmp(&ct, expected_ct, sizeof(ct)), "ct");
	dec(&ss_alice, &ct, &sk);
	// for (u32 i = 0; i < sizeof(ss_bob); i++) print("{}, ",
	// ss_bob.data[i]);

	ASSERT(!fastmemcmp(&ss_bob, &ss_alice, KEM_SS_SIZE), "shared secret");
	u8 expected[32] = {99,	59,  179, 2,   225, 204, 225, 2,  50,  6,  184,
			   161, 135, 207, 99,  13,  230, 127, 34, 221, 32, 1,
			   129, 97,  104, 118, 247, 40,	 205, 99, 225, 184};

	ASSERT(!fastmemcmp(&ss_bob, expected, KEM_SS_SIZE), "expected");
}

Test(kem_iter) {
	KemSecKey sk;
	KemPubKey pk;
	KemCipherText ct;
	KemSharedSecret ss_bob = {0}, ss_alice = {0};
	Rng rng1, rng2;

	for (u32 i = 0; i < 1000; i++) {
		rng_init(&rng1);
		rng_init(&rng2);

		keypair(&pk, &sk, &rng1);
		enc(&ct, &ss_bob, &pk, &rng2);
		dec(&ss_alice, &ct, &sk);
		ASSERT(!fastmemcmp(&ss_bob, &ss_alice, KEM_SS_SIZE),
		       "shared secret");
	}
}

#define KEM_COUNT 10000

Bench(kempf) {
	KemSecKey sk;
	KemPubKey pk;
	KemCipherText ct;
	KemSharedSecret ss_bob = {0}, ss_alice = {0};
	Rng rng1, rng2;
	u64 keygen_sum = 0;
	u64 enc_sum = 0;
	u64 dec_sum = 0;

	for (u32 i = 0; i < KEM_COUNT; i++) {
		rng_init(&rng1);
		rng_init(&rng2);

		u64 start = cycle_counter();
		keypair(&pk, &sk, &rng1);
		keygen_sum += cycle_counter() - start;
		start = cycle_counter();
		enc(&ct, &ss_bob, &pk, &rng2);
		enc_sum += cycle_counter() - start;
		start = cycle_counter();
		dec(&ss_alice, &ct, &sk);
		dec_sum += cycle_counter() - start;
		ASSERT(!fastmemcmp(&ss_bob, &ss_alice, KEM_SS_SIZE),
		       "shared secret");
	}

	pwrite(2, "keygen=", 7, 0);
	write_num(2, keygen_sum / KEM_COUNT);
	pwrite(2, ",enc=", 5, 0);
	write_num(2, enc_sum / KEM_COUNT);
	pwrite(2, ",dec=", 5, 0);
	write_num(2, dec_sum / KEM_COUNT);
	pwrite(2, "\n", 1, 0);
}

#include <dilithium_scalar/sign.h>

#define MLEN 32
#define NTESTS 100

Test(dilithium) {
	i32 ret;
	u64 mlen, smlen;
	u16 v = 0;
	u8 b = 0;
	__attribute__((aligned(32))) u8 m[MLEN + CRYPTO_BYTES] = {0};
	__attribute__((aligned(32))) u8 m2[MLEN + CRYPTO_BYTES] = {0};
	__attribute__((aligned(32))) u8 sm[MLEN + CRYPTO_BYTES] = {0};
	__attribute__((aligned(32))) u8 pk[CRYPTO_PUBLICKEYBYTES] = {0};
	__attribute__((aligned(32))) u8 sk[CRYPTO_SECRETKEYBYTES] = {0};
	u8 seed[32] = {1, 2, 3};
	Rng rng;

	for (u32 i = 0; i < NTESTS; i++) {
		rng_init(&rng);
		rng_gen(&rng, m, MLEN);

		crypto_sign_keypair(pk, sk, seed);
		crypto_sign(sm, &smlen, m, MLEN, NULL, 0, sk, &rng);
		ret = crypto_sign_open(m2, &mlen, sm, smlen, NULL, 0, pk);

		ASSERT(!ret, "verify");
		ASSERT_EQ(smlen, MLEN + CRYPTO_BYTES, "smlen");
		ASSERT_EQ(mlen, MLEN, "mlen");
		ASSERT(!memcmp(m, m2, MLEN), "msg");

		rng_gen(&rng, &v, sizeof(v));
		rng_gen(&rng, &b, sizeof(b));
		v %= MLEN + CRYPTO_BYTES;
		sm[v] += b == 0 ? 1 : b;
		ret = crypto_sign_open(m2, &mlen, sm, smlen, NULL, 0, pk);
		ASSERT(ret, "fail sig");
	}
}

#include <libfam/sign.h>

Test(dilithium_wrapper) {
	Rng rng;
	__attribute__((aligned(32))) u8 seed[32] = {1, 2, 3, 4};
	__attribute__((aligned(32))) u8 msg[32] = {5, 4, 2, 1};
	PublicKey pk;
	SecretKey sk;
	Signature sig;
	rng_init(&rng);
	keyfrom(seed, &sk, &pk);
	sign(msg, &sk, &sig, &rng);
	i32 res = verify(msg, &pk, &sig);
	ASSERT(!res, "verify");
	msg[4]++;
	res = verify(msg, &pk, &sig);
	ASSERT_EQ(res, -1, "bad sig");
}

Test(dilithium_vector) {
	__attribute__((aligned(32))) u8 seed[32] = {1, 2, 3, 4};
	__attribute__((aligned(32))) u8 msg[32] = {5, 4, 2, 1};
	PublicKey pk = {0};
	SecretKey sk = {0};
	Signature sig = {0};
	Rng rng;

	rng_test_seed(&rng, seed);
	keyfrom(seed, &sk, &pk);
	// for (u32 i = 0; i < sizeof(pk); i++) print("{}, ", pk.data[i]);
	sign(msg, &sk, &sig, &rng);
	// for (u32 i = 0; i < sizeof(sig); i++) print("{}, ", sig.data[i]);
	u8 expected_pk[] = {
	    134, 137, 226, 4,	103, 5,	  64,  28,  188, 16,  30,  150, 3,
	    21,	 116, 4,   2,	181, 15,  62,  142, 166, 101, 192, 48,	93,
	    137, 239, 230, 113, 203, 170, 49,  146, 243, 83,  79,  149, 228,
	    12,	 91,  189, 192, 241, 44,  209, 189, 14,	 46,  226, 44,	204,
	    198, 35,  59,  0,	224, 206, 127, 0,   128, 88,  94,  115, 182,
	    79,	 118, 70,  79,	159, 122, 185, 184, 196, 244, 238, 8,	230,
	    151, 149, 78,  63,	196, 155, 224, 175, 183, 94,  103, 218, 131,
	    167, 234, 212, 74,	111, 197, 165, 125, 27,	 143, 165, 245, 27,
	    152, 140, 245, 205, 203, 155, 26,  15,  153, 176, 211, 4,	198,
	    143, 236, 19,  54,	34,  37,  249, 157, 7,	 229, 3,   70,	43,
	    116, 73,  245, 217, 77,  93,  26,  21,  174, 129, 159, 142, 61,
	    173, 235, 149, 29,	203, 103, 155, 61,  164, 33,  188, 89,	236,
	    252, 239, 24,  3,	253, 37,  119, 50,  186, 239, 62,  203, 132,
	    44,	 27,  253, 213, 181, 161, 191, 85,  90,	 246, 75,  98,	112,
	    240, 209, 107, 248, 38,  187, 20,  210, 175, 65,  62,  5,	119,
	    24,	 10,  210, 219, 115, 224, 255, 3,   238, 155, 236, 118, 232,
	    152, 147, 221, 176, 122, 136, 21,  50,  176, 102, 245, 46,	144,
	    204, 200, 231, 62,	231, 81,  232, 224, 67,	 70,  113, 47,	250,
	    245, 116, 130, 64,	10,  219, 118, 107, 246, 111, 189, 59,	132,
	    64,	 80,  126, 6,	53,  87,  227, 243, 217, 243, 191, 208, 79,
	    223, 24,  176, 202, 86,  3,	  218, 178, 65,	 74,  6,   110, 74,
	    110, 191, 229, 182, 40,  85,  178, 204, 210, 203, 115, 225, 156,
	    122, 251, 119, 59,	182, 62,  159, 36,  56,	 149, 60,  46,	24,
	    125, 122, 168, 92,	250, 209, 231, 16,  244, 120, 89,  21,	44,
	    132, 212, 98,  145, 71,  96,  191, 9,   1,	 22,  212, 213, 157,
	    3,	 138, 29,  219, 15,  122, 105, 213, 39,	 70,  106, 46,	178,
	    72,	 15,  23,  28,	56,  64,  205, 20,  113, 182, 207, 86,	87,
	    102, 35,  147, 251, 177, 131, 49,  113, 87,	 126, 35,  18,	182,
	    242, 223, 217, 65,	124, 101, 180, 55,  117, 73,  232, 130, 171,
	    178, 76,  90,  183, 138, 203, 89,  38,  191, 39,  218, 35,	54,
	    98,	 20,  213, 113, 170, 245, 251, 111, 71,	 87,  43,  85,	27,
	    119, 211, 190, 98,	231, 227, 210, 41,  94,	 182, 145, 166, 219,
	    224, 173, 142, 24,	231, 229, 118, 45,  187, 142, 143, 202, 243,
	    190, 253, 39,  154, 46,  160, 66,  38,  180, 251, 234, 205, 67,
	    83,	 234, 209, 212, 191, 167, 35,  143, 58,	 44,  167, 62,	101,
	    36,	 233, 195, 156, 233, 40,  44,  172, 12,	 221, 129, 182, 108,
	    191, 248, 224, 74,	141, 11,  71,  35,  70,	 103, 46,  192, 26,
	    198, 1,   51,  193, 45,  93,  160, 239, 35,	 148, 69,  164, 112,
	    138, 89,  141, 97,	140, 11,  41,  177, 174, 157, 87,  70,	170,
	    66,	 201, 195, 143, 196, 186, 29,  245, 148, 36,  227, 131, 187,
	    98,	 69,  80,  200, 231, 80,  189, 195, 236, 79,  31,  218, 204,
	    110, 193, 27,  13,	232, 207, 167, 228, 158, 42,  47,  185, 149,
	    123, 137, 192, 85,	130, 201, 224, 201, 137, 213, 110, 191, 56,
	    234, 100, 229, 110, 71,  219, 15,  141, 8,	 160, 127, 252, 73,
	    59,	 204, 29,  99,	108, 186, 125, 148, 8,	 163, 68,  51,	89,
	    157, 136, 168, 126, 129, 106, 234, 164, 83,	 95,  76,  119, 53,
	    160, 186, 153, 151, 65,  249, 155, 90,  141, 96,  236, 247, 34,
	    87,	 80,  233, 174, 226, 93,  201, 197, 240, 113, 46,  201, 15,
	    61,	 13,  216, 91,	250, 88,  242, 172, 235, 25,  54,  176, 4,
	    221, 211, 95,  112, 4,   158, 96,  35,  157, 145, 240, 86,	36,
	    117, 12,  237, 55,	100, 209, 84,  237, 233, 186, 79,  71,	60,
	    22,	 79,  99,  42,	172, 47,  158, 102, 105, 138, 175, 222, 173,
	    222, 80,  104, 157, 137, 220, 241, 101, 59,	 122, 90,  253, 142,
	    235, 134, 255, 84,	85,  153, 50,  98,  129, 50,  129, 123, 172,
	    220, 67,  231, 130, 212, 202, 117, 99,  210, 165, 140, 214, 24,
	    254, 73,  177, 52,	37,  114, 178, 133, 47,	 123, 196, 34,	135,
	    244, 127, 234, 139, 60,  179, 215, 113, 81,	 12,  2,   62,	172,
	    78,	 161, 200, 204, 116, 142, 131, 73,  91,	 214, 127, 143, 19,
	    193, 128, 170, 211, 53,  255, 44,  242, 212, 37,  213, 150, 140,
	    213, 67,  162, 103, 84,  234, 18,  142, 103, 142, 47,  182, 204,
	    137, 5,   218, 161, 109, 50,  190, 249, 210, 162, 176, 58,	191,
	    155, 62,  29,  115, 221, 98,  134, 97,  2,	 29,  13,  160, 200,
	    193, 81,  253, 41,	18,  5,	  224, 68,  80,	 15,  74,  19,	14,
	    225, 88,  138, 229, 9,   55,  222, 142, 77,	 176, 37,  10,	221,
	    175, 144, 49,  192, 84,  248, 29,  135, 161, 226, 32,  197, 116,
	    82,	 159, 36,  249, 219, 154, 218, 113, 238, 73,  73,  161, 250,
	    149, 178, 175, 165, 16,  116, 234, 193, 175, 236, 186, 159, 223,
	    137, 147, 193, 16,	210, 222, 159, 107, 114, 16,  69,  34,	30,
	    142, 6,   177, 133, 132, 227, 174, 144, 114, 55,  190, 29,	84,
	    16,	 34,  234, 234, 52,  195, 234, 110, 115, 254, 94,  123, 59,
	    91,	 246, 78,  154, 66,  122, 184, 86,  59,	 49,  45,  246, 59,
	    158, 121, 206, 166, 149, 86,  24,  225, 121, 57,  247, 229, 75,
	    47,	 78,  214, 158, 141, 83,  101, 6,   200, 226, 128, 46,	102,
	    154, 34,  135, 145, 3,   63,  68,  40,  158, 223, 117, 132, 242,
	    147, 131, 182, 124, 147, 58,  48,  220, 105, 166, 193, 183, 141,
	    78,	 219, 29,  252, 142, 34,  162, 102, 178, 72,  96,  251, 34,
	    8,	 164, 152, 18,	6,   149, 33,  203, 106, 253, 206, 127, 92,
	    41,	 81,  218, 179, 187, 232, 192, 230, 137, 131, 106, 75,	83,
	    159, 170, 129, 174, 127, 83,  233, 13,  36,	 6,   32,  210, 104,
	    185, 113, 197, 16,	254, 106, 173, 155, 98,	 8,   86,  207, 137,
	    51,	 6,   184, 34,	70,  88,  219, 236, 17,	 73,  10,  121, 67,
	    129, 84,  128, 221, 60,  1,	  209, 7,   212, 96,  115, 154, 204,
	    122, 244, 43,  33,	98,  55,  246, 147, 227, 201, 21,  167, 153,
	    202, 230, 65,  110, 191, 9,	  152, 85,  228, 146, 19,  202, 83,
	    83,	 234, 47,  209, 135, 169, 8,   239, 236, 160, 167, 33,	182,
	    250, 248, 50,  120, 221, 183, 240, 234, 144, 5,   180, 139, 237,
	    93,	 94,  3,   27,	45,  27,  133, 53,  20,	 95,  24,  235, 82,
	    11,	 127, 83,  227, 1,   93,  163, 210, 53,	 248, 241, 140, 113,
	    152, 214, 250, 220, 69,  107, 110, 229, 216, 187, 14,  43,	219,
	    170, 126, 226, 127, 107, 243, 111, 27,  252, 104, 139, 27,	114,
	    124, 247, 166, 83,	158, 159, 218, 213, 63,	 8,   221, 77,	241,
	    140, 29,  116, 151, 93,  61,  76,  174, 157, 103, 224, 155, 47,
	    143, 182, 199, 17,	169, 24,  143, 209, 174, 188, 17,  234, 153,
	    248, 154, 79,  135, 206, 189, 234, 97,  23,	 170, 161, 34,	87,
	    192, 14,  201, 141, 148, 19,  32,  157, 188, 209, 159, 107, 145,
	    35,	 45,  39,  161, 129, 37,  130, 27,  183, 21,  94,  46,	176,
	    253, 248, 98,  205, 223, 236, 110, 4,   34,	 9,   12,  153, 202,
	    182, 66,  200, 22,	117, 235, 19,  35,  40,	 59,  165, 150, 134,
	    114, 12,  5,   88,	37,  237, 146, 8,   225, 238, 238, 122, 190,
	    1,	 150, 89,  67,	41,  8,	  99,  253, 211, 238, 218, 72,	246,
	    72,	 133, 100, 239, 80,  187, 173, 76,  10,	 128, 128, 69};
	u8 expected_sk[] = {
	    134, 137, 226, 4,	103, 5,	  64,  28,  188, 16,  30,  150, 3,
	    21,	 116, 4,   2,	181, 15,  62,  142, 166, 101, 192, 48,	93,
	    137, 239, 230, 113, 203, 170, 150, 16,  134, 98,  93,  95,	151,
	    72,	 162, 11,  71,	83,  182, 100, 179, 110, 49,  163, 9,	22,
	    173, 205, 137, 15,	170, 217, 93,  9,   45,	 46,  236, 0,	249,
	    249, 246, 182, 239, 219, 123, 38,  249, 118, 160, 102, 45,	238,
	    229, 74,  252, 78,	159, 234, 125, 51,  89,	 241, 18,  191, 102,
	    94,	 31,  85,  6,	66,  115, 212, 0,   9,	 124, 253, 198, 5,
	    190, 43,  236, 110, 84,  64,  238, 45,  20,	 207, 83,  249, 80,
	    84,	 46,  53,  240, 130, 196, 172, 201, 169, 168, 218, 139, 40,
	    37,	 84,  52,  9,	2,   131, 113, 202, 160, 80,  26,  132, 109,
	    228, 130, 36,  195, 6,   108, 89,  72,  5,	 73,  38,  1,	72,
	    194, 1,   16,  64,	65,  8,	  176, 96,  83,	 68,  82,  212, 8,
	    129, 217, 130, 129, 200, 180, 132, 163, 40,	 100, 33,  195, 9,
	    34,	 35,  82,  225, 22,  101, 96,  4,   48,	 138, 192, 32,	146,
	    8,	 68,  36,  199, 140, 219, 6,   9,   81,	 192, 96,  84,	194,
	    8,	 201, 152, 129, 217, 16,  102, 25,  38,	 138, 4,   153, 97,
	    147, 194, 65,  132, 2,   104, 19,  133, 48,	 27,  40,  136, 73,
	    66,	 33,  155, 52,	112, 20,  48,  142, 9,	 163, 13,  16,	16,
	    77,	 208, 40,  49,	226, 48,  141, 2,   133, 41,  24,  183, 4,
	    12,	 70,  129, 96,	34,  102, 25,  183, 136, 219, 168, 64,	35,
	    53,	 64,  156, 164, 140, 90,  144, 33,  16,	 148, 40,  80,	34,
	    81,	 160, 50,  97,	129, 2,	  77,  33,  198, 44,  160, 150, 100,
	    67,	 22,  112, 20,	69,  6,	  130, 16,  10,	 11,  196, 101, 224,
	    180, 77,  25,  134, 48,  225, 70,  110, 34,	 21,  77,  92,	182,
	    49,	 68,  66,  109, 97,  54,  137, 212, 160, 41,  196, 48,	78,
	    28,	 133, 4,   26,	72,  138, 64,  144, 108, 218, 178, 65,	210,
	    64,	 13,  144, 182, 101, 96,  40,  105, 32,	 0,   80,  32,	33,
	    104, 227, 144, 96,	225, 64,  136, 196, 136, 32,  73,  166, 133,
	    17,	 35,  9,   201, 150, 128, 19,  48,  104, 18,  34,  0,	19,
	    199, 109, 210, 162, 76,  67,  184, 9,   163, 200, 48,  203, 50,
	    114, 202, 66,  102, 89,  168, 141, 204, 0,	 112, 35,  23,	140,
	    16,	 133, 100, 192, 182, 36,  72,  38,  76,	 88,  192, 16,	91,
	    34,	 81,  10,  49,	98,  89,  24,  77,  68,	 20,  101, 145, 38,
	    133, 36,  165, 73,	8,   131, 141, 88,  200, 129, 160, 146, 37,
	    64,	 64,  81,  219, 22,  9,	  155, 128, 129, 164, 36,  81,	163,
	    70,	 130, 216, 50,	36,  218, 0,   44,  128, 8,   80,  156, 160,
	    133, 132, 196, 80,	144, 56,  109, 20,  73,	 112, 219, 16,	41,
	    209, 164, 9,   88,	24,  76,  67,  54,  104, 16,  41,  97,	28,
	    48,	 5,   145, 70,	145, 98,  0,   108, 11,	 36,  96,  25,	33,
	    140, 36,  20,  138, 27,  41,  109, 217, 166, 141, 18,  160, 129,
	    24,	 64,  108, 12,	23,  82,  227, 144, 140, 28,  0,   130, 132,
	    56,	 37,  155, 20,	134, 98,  18,  16,  96,	 54,  144, 162, 18,
	    42,	 24,  179, 100, 27,  64,  5,   137, 162, 16,  210, 54,	41,
	    32,	 38,  108, 66,	4,   40,  83,  184, 9,	 128, 164, 44,	20,
	    17,	 66,  28,  198, 49,  27,  196, 104, 132, 178, 0,   12,	57,
	    48,	 3,   199, 141, 204, 148, 64,  204, 180, 104, 4,   32,	81,
	    153, 20,  113, 17,	4,   130, 25,  200, 16,	 226, 150, 144, 80,
	    68,	 70,  161, 164, 1,   131, 184, 137, 74,	 8,   1,   3,	8,
	    136, 3,   4,   33,	154, 66,  70,  161, 180, 77,  88,  200, 32,
	    227, 182, 144, 144, 184, 64,  25,  167, 104, 208, 56,  8,	89,
	    0,	 97,  11,  55,	9,   34,  147, 81,  156, 178, 9,   75,	70,
	    128, 76,  4,   10,	136, 198, 17,  75,  68,	 32,  81,  134, 0,
	    132, 48,  0,   92,	20,  76,  26,  168, 140, 8,   151, 136, 34,
	    177, 109, 68,  198, 44,  73,  8,   76,  36,	 169, 109, 140, 24,
	    4,	 128, 32,  50,	34,  195, 45,  34,  54,	 77,  89,  162, 69,
	    216, 168, 45,  82,	162, 45,  89,  18,  80,	 76,  146, 137, 8,
	    72,	 128, 228, 152, 80,  164, 66,  73,  32,	 32,  65,  10,	16,
	    68,	 193, 150, 41,	12,  150, 77,  91,  54,	 145, 27,  21,	1,
	    74,	 148, 129, 16,	148, 128, 160, 68,  81,	 225, 0,   10,	145,
	    72,	 109, 161, 6,	73,  34,  194, 49,  12,	 18,  145, 74,	182,
	    72,	 11,  181, 128, 81,  66,  18,  227, 32,	 46,  148, 32,	33,
	    153, 54,  68,  145, 72,  101, 9,   201, 145, 36,  18,  13,	74,
	    6,	 14,  20,  181, 13,  194, 180, 65,  75,	 0,   104, 76,	48,
	    108, 10,  18,  48,	154, 192, 140, 17,  135, 81,  217, 40,	42,
	    76,	 56,  74,  75,	36,  112, 27,  2,   136, 88,  24,  100, 2,
	    193, 13,  32,  192, 48,  32,  2,   112, 3,	 8,   130, 36,	176,
	    8,	 0,   66,  66,	36,  200, 108, 136, 72,	 112, 217, 36,	42,
	    27,	 49,  129, 4,	51,  40,  25,  161, 97,	 91,  32,  48,	144,
	    190, 187, 177, 156, 133, 229, 141, 245, 193, 229, 1,   117, 118,
	    13,	 181, 103, 50,	71,  115, 15,  8,   79,	 8,   169, 108, 28,
	    245, 84,  118, 6,	188, 62,  63,  165, 159, 34,  113, 138, 52,
	    73,	 16,  127, 155, 19,  69,  65,  140, 101, 97,  30,  137, 166,
	    237, 250, 198, 183, 218, 65,  102, 30,  4,	 121, 108, 9,	79,
	    73,	 197, 183, 126, 91,  170, 19,  232, 29,	 214, 142, 22,	176,
	    177, 137, 138, 124, 227, 53,  170, 17,  27,	 237, 88,  160, 27,
	    73,	 187, 236, 235, 180, 215, 32,  101, 3,	 98,  40,  28,	219,
	    12,	 90,  249, 38,	247, 165, 5,   130, 114, 227, 13,  131, 47,
	    129, 52,  54,  41,	246, 162, 191, 111, 67,	 78,  1,   119, 88,
	    29,	 168, 195, 249, 27,  70,  15,  121, 210, 130, 55,  62,	63,
	    243, 153, 189, 182, 83,  201, 209, 143, 138, 4,   83,  227, 67,
	    22,	 32,  136, 184, 55,  234, 21,  104, 101, 104, 146, 219, 171,
	    247, 241, 231, 88,	32,  65,  68,  63,  41,	 210, 162, 94,	9,
	    102, 53,  252, 216, 80,  128, 57,  191, 152, 92,  147, 209, 147,
	    226, 203, 58,  130, 47,  39,  55,  133, 74,	 139, 218, 143, 212,
	    182, 179, 41,  202, 39,  25,  191, 230, 71,	 111, 105, 225, 44,
	    169, 240, 108, 116, 96,  75,  252, 101, 148, 100, 2,   125, 91,
	    60,	 132, 189, 192, 62,  58,  78,  201, 176, 152, 115, 3,	48,
	    211, 72,  22,  35,	34,  247, 198, 111, 164, 80,  142, 245, 49,
	    34,	 196, 38,  68,	163, 18,  129, 253, 137, 212, 20,  198, 162,
	    73,	 9,   126, 14,	224, 231, 91,  196, 214, 122, 122, 206, 191,
	    49,	 228, 165, 212, 136, 2,	  22,  75,  82,	 240, 89,  122, 215,
	    181, 158, 184, 252, 21,  15,  6,   130, 137, 225, 245, 131, 239,
	    68,	 55,  119, 10,	51,  201, 20,  122, 157, 202, 133, 62,	88,
	    238, 166, 95,  172, 107, 151, 88,  139, 251, 120, 194, 203, 57,
	    13,	 87,  241, 81,	91,  18,  12,  32,  39,	 36,  30,  11,	253,
	    87,	 53,  93,  83,	195, 26,  94,  21,  84,	 236, 188, 91,	189,
	    71,	 156, 150, 113, 64,  92,  53,  50,  190, 14,  54,  62,	23,
	    241, 85,  38,  190, 92,  211, 141, 103, 246, 5,   32,  89,	48,
	    105, 9,   76,  234, 63,  135, 8,   11,  91,	 61,  79,  152, 115,
	    152, 134, 139, 205, 112, 176, 236, 93,  82,	 101, 227, 151, 180,
	    108, 78,  88,  151, 21,  23,  122, 48,  89,	 254, 38,  114, 153,
	    90,	 220, 191, 127, 134, 145, 32,  81,  141, 91,  44,  131, 77,
	    88,	 239, 186, 245, 79,  248, 197, 222, 136, 183, 176, 195, 251,
	    113, 158, 4,   244, 226, 136, 21,  191, 9,	 0,   149, 166, 32,
	    211, 114, 75,  120, 83,  16,  2,   195, 129, 44,  79,  83,	34,
	    57,	 220, 120, 88,	45,  202, 48,  149, 227, 238, 197, 113, 72,
	    178, 62,  12,  121, 212, 70,  63,  146, 248, 217, 114, 222, 164,
	    197, 81,  65,  53,	180, 196, 206, 126, 196, 248, 88,  241, 137,
	    5,	 160, 67,  51,	129, 55,  176, 231, 214, 149, 65,  24,	234,
	    92,	 176, 201, 102, 188, 214, 4,   115, 181, 157, 93,  233, 78,
	    4,	 137, 15,  161, 36,  90,  247, 168, 3,	 197, 243, 157, 33,
	    201, 112, 165, 159, 5,   248, 12,  151, 213, 121, 159, 214, 99,
	    51,	 249, 153, 233, 153, 98,  241, 181, 94,	 218, 71,  107, 137,
	    95,	 168, 96,  244, 37,  230, 236, 123, 227, 154, 1,   9,	63,
	    158, 54,  196, 246, 9,   238, 93,  18,  222, 181, 50,  120, 116,
	    222, 120, 160, 19,	207, 209, 137, 216, 225, 6,   67,  163, 168,
	    132, 127, 135, 79,	205, 180, 0,   123, 214, 122, 169, 89,	252,
	    14,	 44,  192, 162, 181, 26,  144, 245, 241, 71,  156, 205, 94,
	    37,	 69,  76,  141, 8,   60,  14,  118, 169, 219, 24,  101, 238,
	    224, 97,  48,  11,	218, 55,  233, 65,  126, 7,   131, 237, 248,
	    132, 125, 79,  165, 125, 116, 135, 7,   96,	 224, 209, 243, 128,
	    109, 76,  65,  40,	21,  52,  150, 197, 232, 102, 31,  253, 243,
	    10,	 23,  132, 155, 79,  199, 177, 161, 28,	 102, 106, 250, 10,
	    196, 230, 10,  119, 27,  204, 198, 144, 191, 192, 167, 88,	233,
	    10,	 98,  239, 9,	94,  77,  85,  244, 142, 4,   114, 22,	77,
	    26,	 53,  187, 70,	98,  198, 106, 75,  197, 85,  192, 9,	120,
	    250, 5,   208, 184, 123, 53,  62,  234, 148, 143, 88,  165, 132,
	    248, 52,  18,  171, 85,  39,  56,  174, 196, 100, 223, 75,	249,
	    47,	 88,  56,  232, 54,  188, 103, 142, 182, 170, 125, 112, 135,
	    149, 250, 204, 116, 32,  165, 13,  40,  130, 203, 115, 169, 88,
	    213, 107, 230, 32,	21,  71,  103, 117, 115, 138, 168, 225, 180,
	    128, 191, 29,  129, 147, 130, 200, 221, 235, 98,  171, 182, 52,
	    242, 10,  41,  44,	223, 150, 101, 1,   142, 9,   61,  45,	47,
	    122, 44,  134, 220, 68,  179, 20,  27,  135, 158, 184, 29,	152,
	    85,	 81,  123, 91,	10,  25,  42,  8,   121, 245, 79,  97,	222,
	    225, 45,  40,  4,	47,  165, 28,  82,  184, 250, 67,  197, 88,
	    64,	 47,  144, 3,	131, 232, 121, 100, 28,	 25,  99,  11,	37,
	    15,	 187, 102, 79,	182, 109, 90,  123, 177, 233, 190, 32,	248,
	    203, 208, 168, 251, 194, 237, 197, 15,  98,	 240, 180, 18,	109,
	    120, 157, 201, 27,	174, 207, 53,  96,  241, 54,  134, 1,	253,
	    23,	 38,  5,   235, 94,  242, 232, 147, 119, 40,  85,  51,	240,
	    21,	 208, 115, 84,	201, 23,  242, 95,  214, 80,  169, 221, 24,
	    8,	 82,  184, 43,	231, 34,  135, 28,  23,	 97,  2,   140, 154,
	    8,	 105, 137, 1,	142, 96,  64,  124, 199, 116, 151, 77,	182,
	    89,	 54,  27,  253, 42,  130, 233, 11,  100, 163, 2,   104, 29,
	    237, 164, 202, 83,	157, 193, 141, 74,  231, 37,  110, 78,	182,
	    41,	 71,  150, 61,	148, 208, 207, 9,   41,	 82,  205, 107, 233,
	    21,	 104, 237, 117, 41,  3,	  43,  127, 7,	 22,  121, 128, 78,
	    103, 244, 34,  98,	79,  215, 241, 53,  201, 30,  141, 102, 123,
	    234, 40,  243, 34,	85,  237, 124, 102, 164, 109, 224, 246, 220,
	    243, 192, 6,   93,	142, 37,  174, 170, 135, 93,  16,  236, 48,
	    94,	 158, 117, 236, 107, 157, 80,  33,  217, 1,   91,  34,	71,
	    77,	 168, 173, 55,	243, 87,  212, 99,  169, 134, 32,  16,	209,
	    167, 35,  99,  80,	28,  104, 201, 153, 166, 101, 15,  223, 253,
	    247, 115, 19,  19,	249, 74,  101, 181, 229, 112, 205, 221, 88,
	    109, 5,   55,  146, 96,  191, 113, 246, 176, 203, 189, 224, 60,
	    161, 28,  134, 22,	61,  227, 135, 87,  111, 8,   186, 26,	65,
	    61,	 13,  125, 97,	3,   145, 83,  31,  19,	 216, 76,  108, 31,
	    221, 224, 20,  121, 35,  48,  71,  43,  64,	 0,   19,  4,	143,
	    151, 36,  143, 190, 167, 247, 81,  56,  198, 101, 214, 196, 211,
	    30,	 66,  29,  211, 169, 247, 63,  77,  156, 85,  163, 1,	68,
	    237, 156, 207, 85,	162, 57,  10,  60,  60,	 224, 167, 190, 171,
	    250, 121, 134, 68,	249, 164, 1,   89,  24,	 121, 178, 29,	184,
	    27,	 49,  12,  31,	210, 248, 244, 122, 49,	 254, 221, 53,	182,
	    183, 45,  65,  130, 226, 110, 41,  190, 87,	 75,  157, 8,	62,
	    218, 67,  156, 63,	243, 184, 147, 35,  78,	 144, 228, 115, 14,
	    173, 191, 114, 252, 197, 80,  2,   48,  148, 32,  220, 96,	80,
	    29,	 44,  230, 167, 249, 179, 42,  26,  108, 130, 173, 239, 82,
	    241, 171, 92,  101, 79,  162, 1,   1,   178, 47,  33,  120, 11,
	    11,	 201, 163, 31,	179, 109, 110, 253, 108, 161, 127, 167, 223,
	    162, 155, 100, 255, 176, 15,  154, 39,  174, 178, 109, 124, 231,
	    170, 175, 235, 112, 203, 99,  85,  79,  135, 240, 160, 178, 141,
	    11,	 232, 189, 248, 205, 158, 96,  106, 50,	 13,  115, 137, 155,
	    253, 159, 138, 233, 127, 57,  100, 53,  85,	 66,  221, 206, 118,
	    33,	 82,  121, 63,	39,  195, 172, 100, 160, 94,  186, 243, 36,
	    242, 184, 9,   149, 102, 214, 85,  105, 179, 198, 73,  249, 175,
	    80,	 14,  150, 54,	251, 77,  25,  71,  101, 141, 38,  229, 255,
	    255, 86,  140, 136, 96,  117, 190, 226, 150, 2,   48,  162, 104,
	    153, 189, 1,   141, 193, 209, 76,  111, 207, 34,  99,  146, 206,
	    221, 38,  72,  222, 216, 88,  34,  9,   50,	 125, 27,  158, 112,
	    231, 246, 115, 210, 34,  9,	  146, 131, 218, 255, 46,  254, 192,
	    196, 168, 252, 134, 39,  86,  112, 188, 180, 131, 103, 91,	233,
	    23,	 183, 234, 41,	117, 247, 146, 57,  199, 126, 113, 223, 68,
	    170, 109, 105, 231, 216, 141, 49,  197, 233, 91,  111, 66,	231,
	    227, 233, 52,  239, 114, 33,  238, 76,  253, 147, 227, 38,	121,
	    43,	 166, 33,  15,	61,  190, 235, 170, 158, 106, 183, 115, 202,
	    60,	 236, 118, 7,	173, 177, 52,  45,  12,	 134, 200, 170, 171,
	    188, 223, 240, 139, 133, 146, 48,  159, 181, 58,  175, 213, 62,
	    59,	 15,  228, 50,	88,  233, 46,  182, 137, 84,  136, 180, 222,
	    237, 189, 160, 248, 251, 149, 230, 231, 4,	 151, 3,   228, 42,
	    113, 244, 205, 2,	67,  124, 161, 64,  190, 125, 102, 33,	102,
	    218, 201, 70,  155, 253, 165, 245, 78,  21,	 150, 45,  244, 21,
	    44,	 172, 82,  59,	98,  198, 133, 226, 115, 82,  82,  224, 69,
	    163, 167, 7,   91,	228, 28,  2,   129, 63,	 66,  28,  120, 147,
	    39,	 213, 12,  221, 180, 244, 1,   243, 141, 19,  29,  239, 60,
	    174, 130, 75,  95,	14,  48,  129, 207, 152, 171, 211, 24};
	u8 expected_sig[] = {
	    208, 191, 220, 210, 104, 76,  47,  221, 99,	 210, 0,   51,	33,
	    211, 66,  198, 52,	44,  124, 141, 57,  216, 178, 196, 33,	236,
	    236, 125, 18,  206, 116, 170, 49,  5,   3,	 148, 60,  169, 31,
	    148, 65,  221, 71,	18,  249, 84,  89,  78,	 48,  29,  172, 28,
	    89,	 236, 198, 20,	252, 203, 215, 17,  11,	 154, 171, 93,	159,
	    138, 113, 180, 130, 79,  52,  157, 79,  230, 200, 24,  113, 178,
	    166, 151, 168, 175, 249, 160, 70,  173, 120, 140, 83,  62,	251,
	    5,	 229, 136, 29,	226, 68,  31,  73,  201, 143, 197, 215, 254,
	    98,	 40,  150, 55,	126, 129, 128, 161, 41,	 208, 8,   118, 37,
	    60,	 103, 250, 97,	11,  116, 103, 130, 186, 45,  103, 0,	221,
	    95,	 13,  139, 191, 229, 17,  104, 204, 57,	 104, 251, 100, 88,
	    42,	 225, 7,   130, 49,  192, 36,  242, 229, 171, 4,   102, 186,
	    174, 183, 240, 35,	127, 129, 126, 141, 227, 40,  91,  170, 22,
	    220, 159, 66,  222, 97,  93,  75,  131, 124, 31,  188, 169, 190,
	    197, 55,  220, 194, 5,   96,  126, 27,  23,	 90,  167, 110, 11,
	    96,	 156, 50,  154, 60,  33,  23,  236, 194, 247, 23,  169, 81,
	    235, 139, 20,  70,	49,  210, 87,  91,  11,	 33,  255, 249, 110,
	    191, 191, 244, 212, 11,  210, 151, 72,  234, 64,  117, 213, 36,
	    8,	 23,  112, 129, 203, 98,  144, 13,  187, 167, 66,  227, 92,
	    197, 49,  201, 223, 128, 103, 2,   136, 48,	 178, 185, 212, 110,
	    139, 204, 32,  234, 66,  107, 7,   39,  235, 217, 105, 202, 171,
	    141, 41,  57,  188, 206, 180, 167, 175, 184, 211, 12,  221, 1,
	    118, 14,  13,  25,	84,  25,  213, 72,  70,	 74,  159, 194, 150,
	    159, 194, 237, 199, 108, 87,  76,  145, 190, 8,   90,  176, 158,
	    165, 115, 101, 29,	196, 176, 142, 35,  146, 96,  75,  45,	170,
	    227, 195, 51,  76,	142, 124, 178, 111, 147, 225, 119, 230, 35,
	    200, 110, 149, 157, 129, 247, 250, 237, 0,	 239, 10,  44,	20,
	    178, 253, 27,  103, 59,  142, 2,   101, 228, 195, 28,  232, 133,
	    86,	 28,  173, 5,	180, 97,  70,  75,  117, 251, 24,  160, 97,
	    163, 38,  182, 221, 213, 1,	  157, 148, 209, 234, 221, 95,	151,
	    224, 135, 4,   112, 148, 155, 75,  56,  87,	 147, 71,  247, 129,
	    183, 102, 32,  73,	54,  203, 0,   117, 96,	 88,  69,  44,	142,
	    203, 169, 170, 123, 32,  77,  153, 198, 232, 18,  122, 159, 166,
	    58,	 68,  116, 195, 248, 236, 11,  148, 10,	 4,   208, 36,	62,
	    62,	 153, 123, 224, 10,  5,	  208, 79,  140, 89,  19,  132, 62,
	    152, 69,  127, 200, 64,  186, 38,  193, 69,	 62,  76,  93,	124,
	    18,	 123, 128, 69,	96,  174, 64,  164, 191, 19,  47,  11,	126,
	    35,	 117, 110, 104, 202, 45,  17,  232, 34,	 170, 180, 36,	202,
	    7,	 132, 150, 29,	129, 205, 90,  56,  31,	 135, 10,  194, 221,
	    81,	 89,  63,  119, 60,  249, 211, 64,  166, 254, 78,  147, 211,
	    195, 56,  60,  65,	237, 154, 230, 218, 180, 190, 45,  14,	173,
	    233, 244, 251, 110, 253, 108, 187, 190, 208, 151, 43,  81,	104,
	    65,	 97,  206, 171, 208, 224, 197, 136, 180, 229, 173, 190, 239,
	    173, 88,  163, 185, 29,  26,  217, 92,  229, 33,  246, 48,	150,
	    140, 85,  22,  185, 122, 159, 161, 45,  191, 100, 236, 162, 86,
	    27,	 228, 37,  189, 9,   68,  3,   9,   143, 125, 90,  126, 87,
	    116, 134, 177, 16,	41,  239, 173, 4,   156, 218, 0,   119, 172,
	    218, 161, 207, 146, 173, 58,  193, 120, 192, 100, 179, 186, 63,
	    178, 143, 26,  121, 19,  25,  95,  111, 35,	 9,   121, 185, 185,
	    178, 95,  86,  186, 15,  214, 104, 26,  122, 80,  39,  187, 237,
	    157, 29,  69,  71,	46,  138, 149, 80,  225, 142, 120, 195, 108,
	    175, 111, 67,  227, 200, 194, 116, 103, 106, 7,   116, 131, 30,
	    233, 225, 54,  196, 115, 243, 85,  224, 255, 153, 71,  188, 144,
	    21,	 94,  103, 50,	162, 58,  245, 50,  137, 15,  127, 197, 57,
	    195, 212, 124, 196, 254, 93,  191, 200, 174, 31,  30,  55,	244,
	    36,	 239, 146, 151, 67,  78,  251, 163, 19,	 57,  181, 189, 152,
	    242, 81,  245, 18,	21,  194, 110, 98,  36,	 41,  191, 191, 74,
	    113, 178, 104, 164, 250, 10,  23,  155, 119, 105, 163, 96,	40,
	    32,	 154, 109, 113, 85,  143, 71,  74,  214, 172, 230, 198, 148,
	    37,	 146, 97,  215, 134, 95,  243, 152, 134, 199, 167, 176, 9,
	    53,	 246, 35,  26,	101, 88,  229, 246, 43,	 180, 132, 76,	246,
	    132, 31,  108, 140, 32,  128, 31,  170, 16,	 154, 127, 55,	228,
	    205, 242, 127, 27,	128, 193, 23,  48,  55,	 95,  14,  154, 81,
	    38,	 199, 183, 180, 133, 205, 104, 69,  148, 243, 229, 184, 106,
	    83,	 184, 74,  141, 60,  92,  59,  132, 121, 97,  147, 228, 92,
	    197, 152, 19,  25,	192, 136, 6,   22,  183, 63,  190, 222, 42,
	    228, 9,   248, 89,	157, 76,  236, 203, 131, 86,  156, 156, 19,
	    53,	 139, 254, 192, 96,  240, 98,  144, 142, 78,  128, 17,	220,
	    248, 205, 100, 190, 122, 206, 84,  251, 211, 144, 196, 91,	206,
	    73,	 163, 180, 106, 182, 35,  30,  148, 103, 124, 199, 67,	32,
	    236, 203, 199, 77,	223, 47,  115, 82,  136, 41,  102, 117, 111,
	    94,	 72,  221, 34,	124, 168, 217, 21,  211, 119, 160, 111, 18,
	    152, 209, 218, 185, 234, 28,  38,  233, 87,	 185, 230, 117, 67,
	    138, 168, 53,  130, 39,  153, 214, 74,  56,	 65,  178, 186, 77,
	    64,	 105, 98,  51,	111, 51,  229, 168, 144, 167, 188, 196, 5,
	    89,	 157, 145, 182, 17,  145, 43,  216, 198, 65,  184, 134, 15,
	    88,	 112, 121, 140, 58,  203, 71,  42,  59,	 9,   206, 214, 61,
	    8,	 96,  17,  103, 138, 237, 15,  166, 34,	 134, 152, 183, 52,
	    34,	 29,  117, 49,	99,  88,  194, 37,  25,	 135, 154, 109, 6,
	    95,	 20,  170, 14,	33,  72,  97,  28,  219, 248, 216, 125, 3,
	    124, 71,  57,  47,	96,  253, 36,  71,  185, 97,  80,  35,	72,
	    99,	 181, 119, 213, 128, 102, 203, 182, 93,	 25,  117, 154, 134,
	    112, 220, 47,  33,	255, 97,  254, 2,   68,	 50,  26,  172, 0,
	    51,	 3,   121, 17,	217, 123, 246, 225, 30,	 181, 244, 181, 14,
	    66,	 40,  242, 145, 156, 59,  87,  111, 17,	 248, 163, 38,	111,
	    87,	 24,  131, 55,	232, 195, 221, 92,  120, 220, 17,  177, 88,
	    231, 13,  163, 60,	137, 40,  74,  53,  90,	 5,   179, 234, 3,
	    134, 161, 84,  22,	71,  118, 23,  138, 113, 87,  140, 198, 56,
	    17,	 198, 53,  140, 170, 108, 29,  153, 38,	 198, 19,  185, 159,
	    56,	 40,  2,   142, 240, 232, 203, 133, 177, 198, 91,  57,	159,
	    238, 195, 215, 116, 201, 221, 15,  194, 135, 169, 187, 210, 3,
	    130, 10,  250, 41,	1,   6,	  19,  13,  222, 104, 101, 121, 64,
	    37,	 246, 134, 39,	66,  194, 70,  74,  158, 91,  52,  92,	125,
	    55,	 100, 11,  97,	174, 245, 16,  185, 202, 246, 217, 67,	6,
	    41,	 207, 122, 53,	194, 148, 180, 17,  242, 156, 182, 208, 171,
	    172, 191, 135, 237, 88,  8,	  167, 175, 255, 71,  122, 139, 196,
	    200, 80,  196, 87,	172, 209, 113, 242, 147, 39,  229, 252, 243,
	    55,	 97,  155, 222, 215, 80,  57,  214, 58,	 21,  94,  104, 22,
	    85,	 106, 68,  106, 167, 146, 189, 255, 25,	 201, 27,  250, 151,
	    62,	 174, 57,  122, 123, 18,  236, 31,  116, 254, 27,  98,	69,
	    61,	 95,  212, 68,	162, 205, 165, 238, 73,	 235, 12,  75,	145,
	    228, 102, 104, 79,	115, 39,  253, 17,  84,	 74,  167, 186, 77,
	    134, 78,  142, 228, 157, 192, 237, 87,  35,	 252, 125, 243, 224,
	    142, 44,  38,  20,	86,  6,	  93,  226, 170, 41,  235, 185, 29,
	    87,	 209, 43,  136, 75,  178, 51,  75,  164, 189, 58,  50,	107,
	    152, 181, 52,  4,	253, 157, 0,   181, 105, 82,  19,  125, 117,
	    186, 179, 99,  210, 197, 212, 234, 165, 216, 124, 144, 251, 25,
	    3,	 219, 38,  177, 221, 90,  92,  56,  185, 135, 80,  99,	193,
	    200, 160, 216, 155, 251, 215, 236, 21,  44,	 191, 137, 121, 11,
	    164, 9,   89,  195, 159, 233, 101, 6,   68,	 172, 201, 243, 217,
	    0,	 53,  107, 74,	105, 156, 200, 3,   38,	 227, 95,  76,	109,
	    76,	 74,  186, 145, 157, 68,  123, 42,  132, 144, 113, 39,	160,
	    235, 107, 249, 249, 237, 22,  118, 78,  213, 17,  96,  251, 252,
	    147, 241, 121, 58,	107, 77,  218, 85,  156, 88,  169, 202, 143,
	    255, 58,  121, 26,	228, 195, 30,  158, 150, 132, 159, 176, 46,
	    110, 172, 229, 243, 93,  101, 103, 237, 191, 85,  91,  208, 159,
	    81,	 15,  189, 25,	55,  57,  185, 82,  218, 205, 124, 217, 233,
	    223, 80,  50,  179, 67,  171, 184, 62,  227, 61,  194, 46,	159,
	    27,	 20,  139, 152, 23,  8,	  83,  68,  87,	 104, 118, 74,	153,
	    123, 89,  136, 232, 196, 166, 52,  16,  91,	 51,  68,  110, 69,
	    224, 246, 37,  68,	119, 95,  199, 184, 182, 240, 63,  220, 92,
	    84,	 41,  90,  154, 170, 209, 208, 193, 100, 95,  115, 74,	87,
	    188, 149, 197, 175, 121, 163, 152, 152, 207, 225, 154, 226, 184,
	    245, 154, 189, 116, 75,  202, 230, 192, 220, 193, 64,  32,	14,
	    154, 185, 93,  165, 30,  67,  58,  75,  67,	 223, 111, 76,	197,
	    254, 49,  125, 23,	126, 206, 131, 142, 37,	 47,  2,   105, 227,
	    250, 112, 226, 248, 8,   130, 97,  96,  197, 15,  138, 132, 191,
	    6,	 161, 115, 162, 114, 169, 112, 231, 85,	 178, 168, 108, 207,
	    198, 69,  54,  26,	67,  128, 161, 55,  224, 79,  77,  238, 25,
	    70,	 93,  124, 10,	47,  248, 179, 249, 204, 18,  75,  115, 70,
	    227, 214, 214, 112, 24,  159, 251, 223, 30,	 151, 174, 89,	68,
	    131, 40,  150, 80,	245, 126, 252, 39,  29,	 236, 3,   97,	43,
	    138, 9,   238, 189, 72,  60,  119, 171, 82,	 63,  187, 53,	33,
	    172, 25,  155, 84,	39,  23,  149, 12,  240, 179, 193, 224, 225,
	    34,	 49,  95,  147, 109, 170, 177, 238, 68,	 190, 157, 221, 29,
	    242, 116, 37,  45,	45,  127, 170, 246, 207, 108, 30,  231, 43,
	    93,	 219, 157, 159, 111, 110, 87,  118, 140, 77,  199, 129, 123,
	    106, 36,  220, 29,	199, 187, 173, 154, 119, 198, 255, 203, 247,
	    208, 6,   8,   99,	111, 82,  146, 108, 226, 215, 102, 65,	236,
	    68,	 127, 229, 174, 211, 58,  93,  47,  254, 216, 117, 205, 206,
	    192, 196, 129, 60,	40,  174, 251, 7,   176, 14,  142, 117, 104,
	    174, 150, 63,  15,	43,  193, 133, 26,  245, 136, 209, 101, 107,
	    108, 240, 128, 122, 214, 137, 65,  5,   87,	 135, 33,  49,	168,
	    19,	 209, 194, 172, 183, 11,  96,  9,   89,	 17,  140, 188, 28,
	    210, 254, 28,  186, 83,  177, 77,  41,  84,	 140, 34,  252, 68,
	    99,	 78,  217, 105, 179, 10,  13,  84,  12,	 70,  73,  77,	68,
	    168, 216, 33,  30,	187, 121, 214, 194, 240, 246, 171, 140, 203,
	    214, 103, 37,  130, 79,  132, 84,  127, 139, 199, 249, 146, 17,
	    150, 183, 187, 13,	169, 244, 140, 122, 53,	 117, 226, 227, 37,
	    48,	 39,  218, 218, 191, 10,  114, 172, 211, 26,  155, 227, 127,
	    174, 51,  44,  239, 194, 51,  85,  165, 89,	 53,  48,  12,	104,
	    170, 52,  105, 57,	113, 40,  185, 188, 245, 99,  195, 176, 23,
	    136, 23,  212, 168, 184, 191, 158, 207, 58,	 188, 140, 115, 251,
	    133, 40,  250, 212, 84,  127, 50,  177, 200, 132, 242, 235, 110,
	    96,	 236, 200, 227, 0,   23,  142, 116, 97,	 84,  87,  158, 128,
	    123, 16,  29,  240, 73,  56,  15,  114, 44,	 46,  156, 150, 72,
	    34,	 244, 210, 175, 193, 8,	  163, 232, 42,	 53,  30,  221, 250,
	    138, 60,  174, 206, 181, 1,	  233, 27,  233, 242, 85,  42,	201,
	    102, 94,  195, 105, 242, 72,  253, 213, 51,	 249, 116, 217, 234,
	    198, 115, 215, 196, 53,  107, 50,  178, 140, 129, 103, 59,	158,
	    70,	 193, 195, 53,	249, 232, 147, 193, 151, 86,  233, 229, 86,
	    12,	 2,   25,  132, 106, 35,  100, 152, 50,	 110, 218, 58,	247,
	    144, 82,  191, 138, 4,   53,  25,  94,  124, 60,  155, 188, 171,
	    145, 205, 2,   110, 96,  88,  166, 76,  24,	 6,   128, 195, 125,
	    188, 151, 41,  240, 45,  187, 251, 116, 119, 92,  173, 212, 118,
	    192, 22,  164, 22,	161, 25,  42,  51,  28,	 194, 193, 89,	59,
	    112, 94,  44,  14,	207, 76,  83,  18,  255, 206, 97,  251, 62,
	    173, 205, 50,  52,	244, 167, 39,  140, 73,	 196, 96,  82,	31,
	    153, 149, 97,  116, 56,  101, 179, 180, 120, 237, 11,  75,	209,
	    17,	 15,  5,   154, 166, 11,  187, 91,  167, 145, 225, 150, 235,
	    245, 188, 42,  73,	247, 250, 70,  186, 137, 170, 109, 218, 117,
	    32,	 124, 108, 71,	31,  125, 112, 36,  193, 46,  110, 207, 108,
	    162, 107, 37,  109, 44,  47,  0,   208, 175, 110, 253, 83,	6,
	    206, 240, 41,  245, 143, 80,  91,  240, 56,	 203, 209, 101, 198,
	    163, 244, 18,  49,	175, 73,  154, 57,  210, 212, 207, 197, 117,
	    190, 43,  171, 90,	98,  210, 109, 187, 242, 168, 220, 109, 142,
	    126, 6,   20,  157, 99,  108, 71,  87,  14,	 243, 83,  129, 246,
	    144, 62,  115, 97,	144, 6,	  34,  132, 239, 111, 94,  103, 91,
	    176, 56,  198, 82,	202, 197, 165, 245, 17,	 214, 201, 4,	59,
	    217, 168, 174, 72,	218, 201, 81,  241, 241, 10,  53,  56,	67,
	    75,	 86,  90,  142, 184, 187, 215, 219, 228, 40,  69,  85,	99,
	    116, 138, 158, 161, 175, 176, 183, 193, 204, 211, 214, 227, 236,
	    245, 248, 255, 3,	25,  36,  38,  45,  49,	 66,  97,  104, 110,
	    120, 121, 135, 165, 171, 175, 178, 210, 218, 229, 247, 250, 37,
	    38,	 87,  90,  100, 101, 111, 115, 136, 147, 175, 208, 219, 255,
	    0,	 0,   0,   0,	0,   0,	  0,   0,   0,	 0,   0,   13,	33,
	    55,	 69,  0,   0,	0,   0,	  0,   0,   0,	 0,   0,   0,	0,
	    0};
	ASSERT_EQ(verify(msg, &pk, &sig), 0, "verify");
	ASSERT(!memcmp(expected_sig, sig.data, sizeof(expected_sig)),
	       "expected sig");
	for (u32 i = 0; i < sizeof(sk); i++)
		if (sk.data[i] != expected_sk[i])
			println("{} {} != {}", i, sk.data[i], expected_sk[i]);
	ASSERT(!memcmp(expected_sk, sk.data, sizeof(sk)), "expected sk");
	ASSERT(!memcmp(expected_pk, pk.data, sizeof(pk)), "expected pk");
	(void)expected_sig;
}

